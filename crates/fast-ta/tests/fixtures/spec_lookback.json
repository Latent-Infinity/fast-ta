{
  "name": "Indicator Lookback Periods",
  "description": "Verify output length matches lookback formula for each indicator",
  "rationale": "PRD ยง4.5: Output shape is trimmed, first lookback values are NaN",
  "test_cases": [
    {
      "name": "sma_lookback",
      "indicator": "sma",
      "params": {"period": 5},
      "lookback_formula": "period - 1",
      "expected_lookback": 4,
      "notes": "SMA lookback = period - 1"
    },
    {
      "name": "ema_lookback",
      "indicator": "ema",
      "params": {"period": 5},
      "lookback_formula": "period - 1",
      "expected_lookback": 4,
      "notes": "EMA lookback = period - 1 (same as SMA, first valid at index period-1)"
    },
    {
      "name": "rsi_lookback",
      "indicator": "rsi",
      "params": {"period": 14},
      "lookback_formula": "period",
      "expected_lookback": 14,
      "notes": "RSI lookback = period (needs period+1 data points, first valid at index period)"
    },
    {
      "name": "macd_lookback",
      "indicator": "macd",
      "params": {"fast_period": 12, "slow_period": 26, "signal_period": 9},
      "lookback_formula_macd_line": "slow_period - 1",
      "lookback_formula_signal": "slow_period + signal_period - 2",
      "expected_macd_lookback": 25,
      "expected_signal_lookback": 33,
      "notes": "MACD line lookback = slow_period - 1, Signal lookback = slow_period + signal_period - 2"
    },
    {
      "name": "atr_lookback",
      "indicator": "atr",
      "params": {"period": 14},
      "lookback_formula": "period",
      "expected_lookback": 14,
      "notes": "ATR lookback = period (needs TR values which start at index 1)"
    },
    {
      "name": "bollinger_lookback",
      "indicator": "bollinger",
      "params": {"period": 20, "num_std_dev": 2.0},
      "lookback_formula": "period - 1",
      "expected_lookback": 19,
      "notes": "Bollinger lookback = period - 1 (same as SMA)"
    },
    {
      "name": "stochastic_lookback",
      "indicator": "stochastic",
      "params": {"k_period": 14, "d_period": 3},
      "lookback_formula_k": "k_period - 1",
      "lookback_formula_d": "k_period + d_period - 2",
      "expected_k_lookback": 13,
      "expected_d_lookback": 15,
      "notes": "%K lookback = k_period - 1, %D lookback = k_period + d_period - 2"
    }
  ]
}
